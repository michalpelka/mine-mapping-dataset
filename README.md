# Processing bag files
It allows exporting `rosbag` files and trajectory to LAZ files.
 - [ROSBAG](http://wiki.ros.org/rosbag) is a format used by ROS-1. Those files are raw data from our system, which were compressed to save band witch and storage. The orginal system was run on ROS Melodic.
 - The trajectory is a set of CSV files that were generated by our solutions for SLAM, we provide output. 
   It is a spreadsheet where the first column is a timestamp and the other columns are flattened SE(3) matrices.
 - [LAZ](https://manifold.net/doc/mfd9/las,_laz_lidar.htm) (or LASzip) is a compressed LAS file that is industry standard. We recommend using [CloudCompare](https://github.com/cloudcompare/cloudcompare) to review data. 

We provide a docker image that allows us to compile export tools and get LAZ files.
This docker and compiled payload serves as an excellent starting point toward working with our dataset.

## Preparing a Docker image
Update submodules in this repo.
```
git submodule update --init --recursive
```
Prepare docker image:
```
docker build -t mining_export -f Dockerfile.desktop .
```
Now run the container (e.g. PowerShell on Windows), please adjust `D:/kopalnia_bags/bags-day1` to your dataset.
This directory will be visible as `/data` inside a container.
```
docker run -it --rm --mount type=bind,source="D:/kopalnia_bags/bags-day1",target=/data mining_export
```

## Work in the container - export trajectory
Inside container process dataset with the tools that were compiled for you during the image build.
```
rosrun process_mine_data release_data_laz --bags /data --csv /data --output /data/processed --filter 0.0025
```
In your dataset directory `D:/kopalnia_bags/bags-day1` the directory `processed` should appear.
The whole process is lengthy (around half an hour).

# Visualizing bag files

It allows to visulize data from bag file directly, with known trajectory.

Sample of usage
```
visualize_mine_data --bags bags/day1/Zjazd1_2021-10-29-19-51-33_12.bag --csv results/Zjazd1_2021-10-29-19-51-33_12_VLP32_trj.csv
```
![viewer](docs/viewer.gif)